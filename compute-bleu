#!/usr/bin/env python

# adapted from compute-bleu script by Adam Lopez

import optparse
import sys
import bleu

optparser = optparse.OptionParser()
optparser.add_option("-r", "--reference", dest="reference", default="student-data/first500references.tsv", help="Target language reference sentences")
(opts,_) = optparser.parse_args()

#ref = [line.split("\t") for line in open(opts.reference)]
ref = []
hyp = []
for line in open(opts.reference) :
	fragments = line.split("\t") 
	for translation in fragments : 
		ref.append(translation.strip())

hyp = [line.strip() for line in sys.stdin]
for line in sys.stdin :
	translations = line.split("\t")
	for translation in translations:
		hyp.append(translation.strip())

stats = [0 for i in xrange(10)]
for (r,h) in zip(ref, hyp):
  stats = [sum(scores) for scores in zip(stats, bleu.bleu_stats(h,r))]
print bleu.bleu(stats)

